# å‰ç«¯æ‰“åŒ…æŒ‡å—

## ğŸ“¦ æ‰“åŒ…å‘½ä»¤

### åŸºæœ¬æ‰“åŒ…å‘½ä»¤

```bash
# ä½¿ç”¨ pnpmï¼ˆæ¨èï¼‰
pnpm build

# æˆ–ä½¿ç”¨ npm
npm run build

# æˆ–ä½¿ç”¨ yarn
yarn build
```

### æ‰“åŒ…è¯´æ˜

æ‰“åŒ…å‘½ä»¤ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
1. **æ„å»ºå‰ç«¯é™æ€èµ„æº**ï¼šä½¿ç”¨ Vite æ„å»º React åº”ç”¨
2. **æ„å»ºæœåŠ¡å™¨ç«¯ä»£ç **ï¼šä½¿ç”¨ esbuild æ‰“åŒ… Node.js æœåŠ¡å™¨ä»£ç 

## ğŸ“ è¾“å‡ºç›®å½•

æ‰“åŒ…å®Œæˆåï¼Œæ–‡ä»¶ä¼šè¾“å‡ºåˆ°ä»¥ä¸‹ç›®å½•ï¼š

```
travel-frontend/
â”œâ”€â”€ dist/
â”‚   â”œâ”€â”€ public/          # å‰ç«¯é™æ€èµ„æºï¼ˆç”¨äºéƒ¨ç½²ï¼‰
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ index.js         # æœåŠ¡å™¨ç«¯å…¥å£æ–‡ä»¶
```

**å‰ç«¯é™æ€æ–‡ä»¶ä½ç½®**ï¼š`dist/public/`

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

### åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶

åœ¨ `travel-frontend` ç›®å½•ä¸‹åˆ›å»º `.env` æˆ– `.env.production` æ–‡ä»¶ï¼š

```bash
# API åŸºç¡€åœ°å€ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
VITE_API_BASE_URL=http://your-server-ip:9000/api

# å…¶ä»–ç¯å¢ƒå˜é‡
VITE_APP_TITLE=é’æ˜¥æ—…è´·
```

### ç¯å¢ƒå˜é‡æ–‡ä»¶ä¼˜å…ˆçº§

- `.env.production` - ç”Ÿäº§ç¯å¢ƒï¼ˆæ‰“åŒ…æ—¶ä½¿ç”¨ï¼‰
- `.env.local` - æœ¬åœ°ç¯å¢ƒï¼ˆä¼šè¢« git å¿½ç•¥ï¼‰
- `.env` - é»˜è®¤ç¯å¢ƒå˜é‡

## ğŸš€ å®Œæ•´æ‰“åŒ…æµç¨‹

### 1. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰

```bash
cd travel-frontend
pnpm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# åˆ›å»ºç”Ÿäº§ç¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env.production << EOF
VITE_API_BASE_URL=http://your-server-ip:9000/api
EOF
```

### 3. æ‰§è¡Œæ‰“åŒ…

```bash
pnpm build
```

### 4. éªŒè¯æ‰“åŒ…ç»“æœ

```bash
# æŸ¥çœ‹æ‰“åŒ…åçš„æ–‡ä»¶
ls -lh dist/public/

# åº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š
# - index.html
# - assets/ (åŒ…å« JSã€CSS ç­‰é™æ€èµ„æº)
```

## ğŸ“‹ æ‰“åŒ…é€‰é¡¹

### æŸ¥çœ‹æ„å»ºè¯¦æƒ…

```bash
# æ˜¾ç¤ºè¯¦ç»†æ„å»ºä¿¡æ¯
pnpm build -- --debug

# æŸ¥çœ‹æ„å»ºåˆ†æï¼ˆéœ€è¦å®‰è£… rollup-plugin-visualizerï¼‰
pnpm build -- --mode production
```

### æ¸…ç†æ„å»ºç¼“å­˜

```bash
# åˆ é™¤ dist ç›®å½•
rm -rf dist

# é‡æ–°æ‰“åŒ…
pnpm build
```

## ğŸŒ éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Nginx éƒ¨ç½²ï¼ˆæ¨èï¼‰

å°† `dist/public` ç›®å½•çš„å†…å®¹éƒ¨ç½²åˆ° Nginxï¼š

```bash
# å¤åˆ¶æ–‡ä»¶åˆ° Nginx ç›®å½•
sudo cp -r dist/public/* /var/www/html/

# æˆ–ä½¿ç”¨ rsync
rsync -av dist/public/ user@server:/var/www/html/
```

### æ–¹å¼äºŒï¼šä½¿ç”¨ Docker éƒ¨ç½²

ä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•çš„ `docker-compose.yml`ï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
docker-compose up -d --build frontend
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨ Node.js æœåŠ¡å™¨

é¡¹ç›®åŒ…å«æœåŠ¡å™¨ç«¯ä»£ç ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼š

```bash
# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
pnpm start

# æˆ–
node dist/index.js
```

## âš™ï¸ æ„å»ºé…ç½®è¯´æ˜

### Vite é…ç½®

æ„å»ºé…ç½®åœ¨ `vite.config.ts` ä¸­ï¼š

- **è¾“å‡ºç›®å½•**ï¼š`dist/public`
- **æ ¹ç›®å½•**ï¼š`client/`
- **å…¬å…±èµ„æº**ï¼š`client/public/`

### è‡ªå®šä¹‰æ„å»º

å¦‚æœéœ€è¦ä¿®æ”¹æ„å»ºé…ç½®ï¼Œç¼–è¾‘ `vite.config.ts`ï¼š

```typescript
export default defineConfig({
  build: {
    outDir: 'dist/public',
    emptyOutDir: true,
    // å¯ä»¥æ·»åŠ å…¶ä»–æ„å»ºé€‰é¡¹
    minify: 'terser',
    sourcemap: false,
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
        },
      },
    },
  },
});
```

## ğŸ” å¸¸è§é—®é¢˜

### 1. æ‰“åŒ…å¤±è´¥ï¼šä¾èµ–æœªå®‰è£…

```bash
# è§£å†³æ–¹æ¡ˆï¼šé‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules
pnpm install
pnpm build
```

### 2. æ‰“åŒ…å API è¯·æ±‚å¤±è´¥

**åŸå› **ï¼šç¯å¢ƒå˜é‡æœªæ­£ç¡®é…ç½®

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡æ–‡ä»¶
cat .env.production

# ç¡®ä¿ VITE_API_BASE_URL é…ç½®æ­£ç¡®
```

### 3. æ‰“åŒ…æ–‡ä»¶è¿‡å¤§

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
- å¯ç”¨ä»£ç åˆ†å‰²
- ä½¿ç”¨ CDN åŠ è½½å¤§å‹åº“
- å¯ç”¨ Gzip å‹ç¼©
- ä¼˜åŒ–å›¾ç‰‡èµ„æº

### 4. æ‰“åŒ…åé¡µé¢ç©ºç™½

**æ£€æŸ¥é¡¹**ï¼š
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
- ç¡®è®¤ `index.html` ä¸­çš„èµ„æºè·¯å¾„æ­£ç¡®
- æ£€æŸ¥ Nginx é…ç½®æ˜¯å¦æ­£ç¡®

## ğŸ“Š æ„å»ºæ€§èƒ½ä¼˜åŒ–

### 1. å¯ç”¨å¹¶è¡Œæ„å»º

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export NODE_OPTIONS="--max-old-space-size=4096"
pnpm build
```

### 2. ä½¿ç”¨æ„å»ºç¼“å­˜

```bash
# Vite ä¼šè‡ªåŠ¨ç¼“å­˜ï¼Œæ— éœ€é¢å¤–é…ç½®
# å¦‚æœéœ€è¦æ¸…ç†ç¼“å­˜ï¼š
rm -rf node_modules/.vite
```

### 3. åˆ†ææ‰“åŒ…ä½“ç§¯

```bash
# å®‰è£…åˆ†æå·¥å…·
pnpm add -D rollup-plugin-visualizer

# åœ¨ vite.config.ts ä¸­æ·»åŠ æ’ä»¶
# ç„¶åæ„å»ºå¹¶æŸ¥çœ‹åˆ†ææŠ¥å‘Š
```

## ğŸ¯ ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•

æ‰“åŒ…å‰è¯·ç¡®è®¤ï¼š

- [ ] ç¯å¢ƒå˜é‡å·²æ­£ç¡®é…ç½®ï¼ˆ`.env.production`ï¼‰
- [ ] API åœ°å€æŒ‡å‘ç”Ÿäº§æœåŠ¡å™¨
- [ ] æ‰€æœ‰ä¾èµ–å·²å®‰è£…
- [ ] ä»£ç å·²é€šè¿‡ç±»å‹æ£€æŸ¥ï¼ˆ`pnpm check`ï¼‰
- [ ] å·²æµ‹è¯•å¼€å‘ç¯å¢ƒåŠŸèƒ½æ­£å¸¸

æ‰“åŒ…åè¯·éªŒè¯ï¼š

- [ ] `dist/public` ç›®å½•å·²ç”Ÿæˆ
- [ ] `index.html` æ–‡ä»¶å­˜åœ¨
- [ ] é™æ€èµ„æºæ–‡ä»¶å®Œæ•´
- [ ] å¯ä»¥æ­£å¸¸è®¿é—®é¡µé¢
- [ ] API è¯·æ±‚æ­£å¸¸

## ğŸ“ å¿«é€Ÿå‚è€ƒ

```bash
# å®Œæ•´æ‰“åŒ…æµç¨‹
cd travel-frontend
pnpm install                    # å®‰è£…ä¾èµ–
echo "VITE_API_BASE_URL=http://your-server:9000/api" > .env.production  # é…ç½®ç¯å¢ƒå˜é‡
pnpm build                     # æ‰§è¡Œæ‰“åŒ…
ls -lh dist/public/            # æŸ¥çœ‹æ‰“åŒ…ç»“æœ

# éƒ¨ç½²åˆ°æœåŠ¡å™¨
scp -r dist/public/* user@server:/var/www/html/
```

---

**æ³¨æ„**ï¼šæ‰“åŒ…å‰è¯·ç¡®ä¿å·²é…ç½®æ­£ç¡®çš„ç”Ÿäº§ç¯å¢ƒ API åœ°å€ï¼







